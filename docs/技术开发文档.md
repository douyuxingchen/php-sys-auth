# 技术开发文档
当你看到这个文档的时候，相信你，已经将该SDK成功接入您的业务系统了，所以该文档将会对一些技术细节进行说明。

## 配置文件
生成的配置文件在 `config/sys_auth.php`, 如果不存在，请阅读 README 文件，重新生成该配置文件。  
该配置文件用于管理 API 请求的限流控制，包括 IP 限流、路由限流以及接口请求速率限制。这些控制措施旨在确保系统能够有效处理请求并保护其稳定性和安全性。

### IP 限流控制
- **ip_limit**
    - **status**: 设置为 `true` 以启用 IP 验证限制。
    - **white_list**: 白名单中列出的 IP 地址将不受限制。在开发环境中进行调试时，可以将开发者的 IP 地址添加到白名单中。

### 路由限流控制
- **route_limit**
    - **status**: 设为 `true` 以开启 API 路由请求白名单限制。
    - **white_list**: 列出的路由将不受限制。在开发环境中进行调试时，可以将开发者需要调试的路由添加到白名单中。

### 接口限流配置
- **api_rate**
    - **status**: 设置为 `true` 以启用 API 请求速率限制。
    - **eval**: 设为 `true` 以启用 Lua 执行，这可以加快限流算法的效率。
    - **rate_type**: 可选择的算法类型包括 `counter`（计数器）、`window`（时间窗口）和 `bucket`（令牌桶）。根据系统需求，选择适合的算法类型。

### 有状态的服务配置
- **mysql_connect_name**: 指定 MySQL 数据库连接名称。请确保在 `config/database.php` 文件的 `connections.mysql` 中定义了相应的连接名称，并在此处进行配置。
- **redis_connect_name**: 指定 Redis 数据库连接名称。请确保在 `config/database.php` 文件的 `connections.redis` 中定义了相应的连接名称，并在此处进行配置。

请谨慎配置这些参数，以确保系统在高负载和异常情况下仍能正常运行。适当的限流措施可以维持系统的稳定性并防止恶意请求对系统造成影响。

## 错误码使用指南

这份错误码列表旨在提供对特定异常情况的标识，以便进行进一步的异常处理。注意，这些错误码不应直接暴露给业务端，而是作为异常处理的参考标识。

### Token类异常处理
- **ValidationException** 和 **TokenInvalidException**
  - 表示签名验证失败，建议进行统一处理并返回反馈给调用方。

### App类异常处理
- **ErrCodeException**
  - 表示业务错误，需要根据不同的code进行具体业务处理后返回给调用方进行修正处理。

### 配置文件异常处理
- **ConfigException**
  - 此类的错误通常是该包的应用方，配置了错误的配置文件导致的，需要使用此SDK开发者自行处理

### 使用建议
- **异常判断**：根据不同的异常类型进行具体处理，而不是仅依赖于错误码。针对 Token 类异常，考虑统一处理签名验证失败情况，而对于 App 类异常，则需根据不同的code进行业务处理。
- **反馈给调用方**：不要直接将错误码暴露给业务端，而是在适当的时候，根据异常类型返回合适的反馈信息或进行修正处理。

这样的处理方式能更好地区分不同类型的异常并采取相应措施，以确保系统在遇到异常情况时能够给出恰当的反馈或进行必要的修正。

| Code  | Meaning                                     |
|-------|----------------------------------------------|
| 10000 | Token信息不完整                               |
| 10001 | Token校验失败                                 |
| 10002 | Token已经过期                                 |
| 10003 | payload中appKey不能为空                         |
| 10004 | payload中exp不能为空                           |
| 10005 | appKey和payload中提供的payload不匹配            |
| 10006 | payload中exp不能超过24小时                       |
| 20000 | 您提供的appKey不存在                            |
| 20001 | 该appKey不是启用的状态                          |
| 20005 | 在IP黑名单模式下，该IP被拦截                      |
| 20006 | 在IP白名单模式下，该IP被拦截                      |
| 20010 | 您请求的接口未被授权                            |
| 20015 | 请求过于频繁                                  |
| 30000 | 配置文件配置错误                               |
